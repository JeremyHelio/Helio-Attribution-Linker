___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Helio Attribution Linker",
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/jpeg;base64,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\u003d\u003d"
  },
  "description": "Helio Attribution Linker provides simple integration with the Helio Attribution Solution.\nControl attribution to reflect the right channels to accurately measure success.",
  "containerContexts": [
    "WEB"
  ],
  "categories": [
    "ATTRIBUTION",
    "ANALYTICS",
    "MARKETING"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "clientTab",
    "displayName": "Client Tab",
    "simpleValueType": true,
    "valueHint": "TAB_NAME",
    "help": "Client Tab name in Helio Attribution Solution"
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

// Inject script which adds a dataLayerPusher function to the window object, then call this new function in window, which will get UTM parameters from advertience API and push to dataLayer
const injectScript = require('injectScript');
const callInWindow = require('callInWindow');
const scriptUrl = 'https://cdn.jsdelivr.net/gh/JeremyHelio/Helio-Attribution-Linker@1.0.1/attributeControl.js';

injectScript(scriptUrl, onSuccess, data.gtmOnFailure);

function onSuccess() {
  callInWindow('attributeControl', data.clientTab);
  data.gtmOnSuccess();
}


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "attributeControl"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://cdn.jsdelivr.net/gh/advertience-inc/Attribution-Linker@v1.0.1/attributeControl.js"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: InjectScript Success
  code: |-
    mock('injectScript', (str, onSuccess, onFailure) => onSuccess());

    runCode({});

    assertApi('gtmOnSuccess').wasCalled();
- name: InjectScript Success callInWindow
  code: |-
    mock('injectScript', (str, onSuccess, onFailure) => onSuccess());

    runCode({clientTab: 'test'});

    assertApi('callInWindow').wasCalledWith('attributeControl', 'test');
- name: InjectScript Failure
  code: |-
    mock('injectScript', (str, onSuccess, onFailure) => onFailure());

    runCode({});

    assertApi('gtmOnFailure').wasCalled();


___NOTES___

Created on 6/13/2023, 2:48:15 PM


